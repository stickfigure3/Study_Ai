version: 1
# No platform key needed here usually
backend: # Use top-level backend key
  phases:
    build:
      commands:
        # Define variables (replace 'study-app-image')
        - REPOSITORY_NAME=study_ai
        - IMAGE_URI=$AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$REPOSITORY_NAME
        - IMAGE_TAG_VERSION=$AWS_BRANCH-$AWS_COMMIT_ID
        - IMAGE_TAG_LATEST=latest

        - echo "Logging in to Amazon ECR..."
        - aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com

        - echo "Building the Docker image..."
        # Assuming Dockerfile is at the root of the repository
        - docker build -t $REPOSITORY_NAME .

        - echo "Tagging the Docker image for ECR..."
        - docker tag $REPOSITORY_NAME:latest $IMAGE_URI:$IMAGE_TAG_VERSION
        - docker tag $REPOSITORY_NAME:latest $IMAGE_URI:$IMAGE_TAG_LATEST

        - echo "Pushing the Docker image to ECR..."
        - docker push $IMAGE_URI:$IMAGE_TAG_VERSION
        - docker push $IMAGE_URI:$IMAGE_TAG_LATEST
# NO frontend section needed in this structure
# NO applications section needed